<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#050505">
    <meta name="description" content="R√°dio Indie Neon - Player futurista com visualizador de √°udio e efeitos neon">
    <title>R√°dio Indie Neon</title>
    
    <!-- Fonte Orbitron -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700;800;900&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    
    <style>
        /* ===== RESET & BASE ===== */
        *, *::before, *::after {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        :root {
            --neon-primary: #00f3ff;
            --neon-secondary: #bc13fe;
            --neon-accent: #ff006e;
            --neon-green: #39ff14;
            --neon-orange: #ff9500;
            --dark: #050505;
            --darker: #020202;
            --glass: rgba(10, 10, 10, 0.7);
            --glass-border: rgba(255, 255, 255, 0.08);
        }

        html, body {
            height: 100%;
            overflow: hidden;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background-color: #050505;
            /* Configura√ß√µes para o Wallpaper Din√¢mico */
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            background-attachment: fixed; /* Mant√©m o fundo fixo enquanto o player interage */
            transition: background-image 0.8s ease-in-out; /* Transi√ß√£o suave ao trocar de m√∫sica */
            
            color: #fff;
            display: flex;
            flex-direction: column;
        }

        /* Overlay escuro para garantir legibilidade sobre qualquer wallpaper */
        body::before {
            content: '';
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(5, 5, 5, 0.6); /* Escurece o wallpaper */
            z-index: 0;
            pointer-events: none;
        }

        /* ===== MAIN CONTAINER ===== */
        .app-container {
            position: relative;
            z-index: 10;
            height: 100%;
            display: flex;
            flex-direction: column;
            max-width: 480px;
            margin: 0 auto;
            padding: 20px;
            padding-top: env(safe-area-inset-top);
            padding-bottom: env(safe-area-inset-bottom);
        }

        /* ===== HEADER ===== */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            margin-bottom: 20px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo-icon {
            width: 42px;
            height: 42px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--neon-primary), var(--neon-secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            animation: logoRotate 10s linear infinite, logoPulse 2s ease-in-out infinite;
            box-shadow: 0 0 20px var(--neon-primary);
        }

        @keyframes logoRotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        @keyframes logoPulse {
            0%, 100% { box-shadow: 0 0 15px var(--neon-primary); }
            50% { box-shadow: 0 0 30px var(--neon-secondary), 0 0 50px var(--neon-primary); }
        }

        .logo-icon svg {
            width: 22px;
            height: 22px;
            color: #000;
        }

        .logo-text h1 {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.3rem;
            font-weight: 800;
            background: linear-gradient(90deg, #fff, var(--neon-primary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: 1px;
        }

        .logo-text span {
            font-size: 0.6rem;
            color: rgba(255,255,255,0.4);
            letter-spacing: 0.3em;
            text-transform: uppercase;
        }

        /* Status Badge */
        .status-badge {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 14px;
            border-radius: 20px;
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }

        .status-badge.live {
            border-color: var(--neon-primary);
            box-shadow: 0 0 20px var(--neon-primary)40;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #444;
            transition: all 0.3s ease;
        }

        .status-badge.live .status-dot {
            background: var(--neon-primary);
            animation: dotPulse 1.5s ease-in-out infinite;
        }

        @keyframes dotPulse {
            0%, 100% { 
                transform: scale(1);
                box-shadow: 0 0 5px var(--neon-primary);
            }
            50% { 
                transform: scale(1.3);
                box-shadow: 0 0 15px var(--neon-primary), 0 0 25px var(--neon-primary);
            }
        }

        .status-text {
            font-size: 0.7rem;
            font-weight: 700;
            letter-spacing: 0.15em;
            color: #666;
            transition: color 0.3s ease;
        }

        .status-badge.live .status-text {
            color: var(--neon-primary);
        }

        /* ===== VISUALIZER SECTION ===== */
        .visualizer-section {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .album-container {
            position: relative;
            width: 260px;
            height: 260px;
            margin-bottom: 30px;
        }

        @media (min-width: 400px) {
            .album-container {
                width: 300px;
                height: 300px;
            }
        }

        /* Anel externo rotativo */
        .album-ring {
            position: absolute;
            inset: -8px;
            border-radius: 50%;
            padding: 3px;
            background: conic-gradient(from 0deg, var(--neon-primary), var(--neon-secondary), var(--neon-accent), var(--neon-primary));
            animation: ringRotate 4s linear infinite;
            -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
            -webkit-mask-composite: xor;
            mask-composite: exclude;
        }

        @keyframes ringRotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        /* Anel interno pulsante */
        .album-ring-inner {
            position: absolute;
            inset: -4px;
            border-radius: 50%;
            border: 1px solid transparent;
            background: linear-gradient(135deg, var(--neon-primary), var(--neon-secondary)) border-box;
            -webkit-mask: linear-gradient(#fff 0 0) padding-box, linear-gradient(#fff 0 0);
            -webkit-mask-composite: xor;
            mask-composite: exclude;
            opacity: 0.5;
            animation: ringPulse 2s ease-in-out infinite;
        }

        @keyframes ringPulse {
            0%, 100% { transform: scale(1); opacity: 0.5; }
            50% { transform: scale(1.02); opacity: 0.8; }
        }

        /* Canvas do visualizador */
        #visualizer-canvas {
            position: absolute;
            inset: 0;
            width: 100%;
            height: 100%;
        }

        /* Capa do √°lbum */
        .album-cover {
            position: absolute;
            inset: 35px;
            border-radius: 50%;
            overflow: hidden;
            box-shadow: 
                0 0 40px var(--neon-primary)60,
                inset 0 0 60px rgba(0,0,0,0.5);
            animation: albumPulse 3s ease-in-out infinite;
        }

        @keyframes albumPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }

        .album-cover img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: opacity 0.5s ease;
        }

        .album-placeholder {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, var(--neon-primary)30, var(--neon-secondary)30);
        }

        .album-placeholder svg {
            width: 60px;
            height: 60px;
            color: rgba(255,255,255,0.3);
        }

        /* Loading overlay */
        .loading-overlay {
            position: absolute;
            inset: 35px;
            border-radius: 50%;
            background: rgba(0,0,0,0.7);
            backdrop-filter: blur(5px);
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        .loading-overlay.active {
            opacity: 1;
            pointer-events: all;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 3px solid transparent;
            border-top-color: var(--neon-primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            box-shadow: 0 0 15px var(--neon-primary);
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* ===== TRACK INFO ===== */
        .track-info {
            text-align: center;
            margin-bottom: 25px;
            padding: 0 10px;
        }

        .track-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.4rem;
            font-weight: 700;
            color: #fff;
            margin-bottom: 8px;
            text-shadow: 0 0 20px var(--neon-primary)80;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            animation: titleGlow 3s ease-in-out infinite;
        }

        @keyframes titleGlow {
            0%, 100% { text-shadow: 0 0 20px var(--neon-primary)80; }
            50% { text-shadow: 0 0 30px var(--neon-secondary)80, 0 0 40px var(--neon-primary)60; }
        }

        .track-artist {
            font-size: 0.85rem;
            color: rgba(255,255,255,0.5);
            text-transform: uppercase;
            letter-spacing: 0.15em;
        }

        /* ===== CONTROLS ===== */
        .controls-container {
            width: 100%;
        }

        .controls-glass {
            background: var(--glass);
            backdrop-filter: blur(25px);
            -webkit-backdrop-filter: blur(25px);
            border: 1px solid var(--glass-border);
            border-top: 1px solid rgba(255,255,255,0.1);
            border-radius: 24px;
            padding: 24px;
            box-shadow: 
                0 -10px 40px rgba(0,0,0,0.5),
                0 0 40px var(--neon-primary)10;
        }

        /* Main controls */
        .main-controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 25px;
            margin-bottom: 24px;
        }

        .control-btn {
            width: 56px;
            height: 56px;
            border-radius: 50%;
            border: none;
            background: rgba(255,255,255,0.05);
            color: rgba(255,255,255,0.7);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .control-btn:hover {
            background: rgba(255,255,255,0.1);
            transform: scale(1.1);
        }

        .control-btn:active {
            transform: scale(0.95);
        }

        .control-btn svg {
            width: 24px;
            height: 24px;
        }

        .play-btn {
            width: 72px;
            height: 72px;
            background: #fff;
            color: #000;
            box-shadow: 0 0 30px rgba(255,255,255,0.3);
        }

        .play-btn:hover {
            box-shadow: 0 0 40px rgba(255,255,255,0.5);
        }

        .play-btn.playing {
            background: linear-gradient(135deg, var(--neon-primary), var(--neon-secondary));
            color: #fff;
            animation: playGlow 2s ease-in-out infinite;
        }

        @keyframes playGlow {
            0%, 100% { box-shadow: 0 0 30px var(--neon-primary)80; }
            50% { box-shadow: 0 0 50px var(--neon-secondary)80, 0 0 70px var(--neon-primary)60; }
        }

        .play-btn svg {
            width: 30px;
            height: 30px;
        }

        /* Volume control */
        .volume-control {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .volume-btn {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border: none;
            background: transparent;
            color: rgba(255,255,255,0.5);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            flex-shrink: 0;
        }

        .volume-btn:hover {
            color: var(--neon-primary);
            background: rgba(255,255,255,0.05);
        }

        .volume-btn svg {
            width: 20px;
            height: 20px;
        }

        .volume-slider-container {
            flex: 1;
            position: relative;
            height: 24px;
            display: flex;
            align-items: center;
        }

        .volume-slider {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            -webkit-appearance: none;
            appearance: none;
            background: rgba(255,255,255,0.1);
            outline: none;
            cursor: pointer;
        }

        .volume-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--neon-primary), var(--neon-secondary));
            cursor: pointer;
            box-shadow: 0 0 10px var(--neon-primary), 0 0 20px var(--neon-primary);
            transition: transform 0.2s ease;
        }

        .volume-slider::-webkit-slider-thumb:hover {
            transform: scale(1.3);
        }

        .volume-slider::-moz-range-thumb {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--neon-primary), var(--neon-secondary));
            cursor: pointer;
            border: none;
            box-shadow: 0 0 10px var(--neon-primary);
        }

        .volume-value {
            font-size: 0.75rem;
            color: rgba(255,255,255,0.4);
            width: 36px;
            text-align: right;
            flex-shrink: 0;
        }

        /* ===== ACTION BUTTONS ===== */
        .action-buttons {
            display: flex;
            justify-content: center;
            gap: 12px;
            margin-top: 20px;
        }

        .action-btn {
            width: 48px;
            height: 48px;
            border-radius: 14px;
            border: none;
            background: rgba(255,255,255,0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.08);
            color: rgba(255,255,255,0.5);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .action-btn:hover {
            background: rgba(255,255,255,0.1);
            transform: translateY(-2px);
        }

        .action-btn.active {
            background: var(--neon-accent)20;
            border-color: var(--neon-accent);
            color: var(--neon-accent);
        }

        .action-btn svg {
            width: 22px;
            height: 22px;
        }

        /* ===== FOOTER ===== */
        .footer {
            text-align: center;
            padding: 15px 0;
        }

        .footer p {
            font-size: 0.65rem;
            color: rgba(255,255,255,0.25);
            letter-spacing: 0.15em;
        }

        /* ===== COLOR TRANSITIONS ===== */
        .album-ring,
        .spinner,
        .track-title,
        .volume-slider::-webkit-slider-thumb,
        .play-btn.playing {
            transition: all 1s ease;
        }

        /* ===== RESPONSIVE ===== */
        @media (max-height: 700px) {
            .album-container {
                width: 220px;
                height: 220px;
            }
            
            .track-title {
                font-size: 1.2rem;
            }
            
            .controls-glass {
                padding: 20px;
            }
        }

        /* ===== REDUCED MOTION ===== */
        @media (prefers-reduced-motion: reduce) {
            *, *::before, *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }

        /* ===== SELECTION ===== */
        ::selection {
            background: var(--neon-primary);
            color: #000;
        }
    </style>
</head>
<body>
    <!-- Main App -->
    <div class="app-container">
        <!-- Header -->
        <header class="header">
            <div class="logo">
                <div class="logo-icon">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="12" cy="12" r="2"/>
                        <path d="M16.2 7.8c2.3 2.3 2.3 6.1 0 8.5"/>
                        <path d="M19.1 4.9C23 8.8 23 15.1 19.1 19"/>
                        <path d="M4.9 19.1C1 15.2 1 8.8 4.9 4.9"/>
                        <path d="M7.8 16.2c-2.3-2.3-2.3-6.1 0-8.5"/>
                    </svg>
                </div>
                <div class="logo-text">
                    <h1>INDIE NEON</h1>
                    <span>R√°dio Online</span>
                </div>
            </div>

            <div class="status-badge" id="statusBadge">
                <div class="status-dot"></div>
                <span class="status-text" id="statusText">OFFLINE</span>
            </div>
        </header>

        <!-- Visualizer Section -->
        <section class="visualizer-section">
            <div class="album-container">
                <div class="album-ring"></div>
                <div class="album-ring-inner"></div>
                <canvas id="visualizer-canvas"></canvas>
                <div class="album-cover" id="albumCover">
                    <div class="album-placeholder">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M9 18V5l12-2v13"/>
                            <circle cx="6" cy="18" r="3"/>
                            <circle cx="18" cy="16" r="3"/>
                        </svg>
                    </div>
                </div>
                <div class="loading-overlay" id="loadingOverlay">
                    <div class="spinner"></div>
                </div>
            </div>

            <div class="track-info">
                <h2 class="track-title" id="trackTitle">R√°dio Indie Neon</h2>
                <p class="track-artist" id="trackArtist">Aguardando conex√£o...</p>
            </div>
        </section>

        <!-- Controls -->
        <div class="controls-container">
            <div class="controls-glass">
                <div class="main-controls">
                    <!-- Stop Button -->
                    <button class="control-btn" id="btnStop" title="Parar">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <rect x="6" y="6" width="12" height="12" rx="2"/>
                        </svg>
                    </button>

                    <!-- Play/Pause Button -->
                    <button class="control-btn play-btn" id="btnPlay" title="Play/Pause">
                        <svg id="iconPlay" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M8 5v14l11-7z"/>
                        </svg>
                        <svg id="iconPause" viewBox="0 0 24 24" fill="currentColor" style="display: none;">
                            <rect x="6" y="4" width="4" height="16" rx="1"/>
                            <rect x="14" y="4" width="4" height="16" rx="1"/>
                        </svg>
                    </button>

                    <!-- Mute Button -->
                    <button class="control-btn" id="btnMute" title="Mudo">
                        <svg id="iconVol" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/>
                            <path d="M15.54 8.46a5 5 0 0 1 0 7.07"/>
                            <path d="M19.07 4.93a10 10 0 0 1 0 14.14"/>
                        </svg>
                        <svg id="iconMute" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: none;">
                            <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/>
                            <line x1="23" y1="9" x2="17" y2="15"/>
                            <line x1="17" y1="9" x2="23" y2="15"/>
                        </svg>
                    </button>
                </div>

                <!-- Volume Control -->
                <div class="volume-control">
                    <button class="volume-btn" id="btnVolDown">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/>
                        </svg>
                    </button>
                    <div class="volume-slider-container">
                        <input type="range" class="volume-slider" id="volSlider" min="0" max="1" step="0.01" value="0.85">
                    </div>
                    <span class="volume-value" id="volValue">85%</span>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="action-buttons">
                <button class="action-btn" id="btnLike" title="Curtir">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/>
                    </svg>
                </button>
                <button class="action-btn" id="btnPlaylist" title="Playlist">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M16 6H3"/>
                        <path d="M16 12H3"/>
                        <path d="M16 18H3"/>
                        <path d="M21 6v10"/>
                        <path d="M18 16l3 3 3-3"/>
                    </svg>
                </button>
                <button class="action-btn" id="btnShare" title="Compartilhar">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="18" cy="5" r="3"/>
                        <circle cx="6" cy="12" r="3"/>
                        <circle cx="18" cy="19" r="3"/>
                        <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/>
                        <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/>
                    </svg>
                </button>
                <button class="action-btn" id="btnEffects" title="Efeitos">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/>
                    </svg>
                </button>
            </div>
        </div>

        <!-- Footer -->
        <footer class="footer">
            <p>INDIE NEON R√ÅDIO ¬© 2025</p>
        </footer>
    </div>

    <!-- Audio Element -->
    <audio id="audioPlayer" crossorigin="anonymous" preload="none"></audio>

    <script>
        // ============================================
        // CONFIGURA√á√ïES - EDITE AQUI SEU STREAMING
        // ============================================
        const CONFIG = {
            // URL do seu streaming Icecast/Shoutcast
            STREAM_URL: 'https://citizens-increasingly-lie-kent.trycloudflare.com/stream',
            
            // URL do status JSON (metadata)
            STATUS_URL: 'https://citizens-increasingly-lie-kent.trycloudflare.com/status-json.xsl',
            
            // API Key do Last.fm (para buscar capas)
            LASTFM_KEY: '73b5fb24854700c462c68a42d7ccae2b',
            
            // Intervalo de atualiza√ß√£o do metadata (ms)
            META_INTERVAL: 10000,
            
            // Cores neon que alternam
            NEON_COLORS: [
                { primary: '#00f3ff', secondary: '#bc13fe', accent: '#ff006e' },
                { primary: '#ff006e', secondary: '#00f3ff', accent: '#bc13fe' },
                { primary: '#bc13fe', secondary: '#ff006e', accent: '#00f3ff' },
                { primary: '#39ff14', secondary: '#ff00ff', accent: '#00ffff' },
                { primary: '#ff9500', secondary: '#00d4ff', accent: '#ff00aa' },
            ]
        };

        // ============================================
        // ESTADO GLOBAL
        // ============================================
        const state = {
            isPlaying: false,
            isMuted: false,
            volume: 0.85,
            colorIndex: 0,
            lastTitle: '',
            audioContext: null,
            analyser: null,
            dataArray: null,
            liked: false
        };

        // ============================================
        // ELEMENTOS DOM
        // ============================================
        const elements = {
            audio: document.getElementById('audioPlayer'),
            btnPlay: document.getElementById('btnPlay'),
            btnStop: document.getElementById('btnStop'),
            btnMute: document.getElementById('btnMute'),
            btnVolDown: document.getElementById('btnVolDown'),
            btnLike: document.getElementById('btnLike'),
            btnShare: document.getElementById('btnShare'),
            iconPlay: document.getElementById('iconPlay'),
            iconPause: document.getElementById('iconPause'),
            iconVol: document.getElementById('iconVol'),
            iconMute: document.getElementById('iconMute'),
            volSlider: document.getElementById('volSlider'),
            volValue: document.getElementById('volValue'),
            statusBadge: document.getElementById('statusBadge'),
            statusText: document.getElementById('statusText'),
            trackTitle: document.getElementById('trackTitle'),
            trackArtist: document.getElementById('trackArtist'),
            albumCover: document.getElementById('albumCover'),
            loadingOverlay: document.getElementById('loadingOverlay'),
            visualizerCanvas: document.getElementById('visualizer-canvas')
        };

        // ============================================
        // FUN√á√ïES UTILIT√ÅRIAS
        // ============================================
        function hexToRgba(hex, alpha) {
            const r = parseInt(hex.slice(1, 3), 16);
            const g = parseInt(hex.slice(3, 5), 16);
            const b = parseInt(hex.slice(5, 7), 16);
            return `rgba(${r}, ${g}, ${b}, ${alpha})`;
        }

        function updateColors() {
            const colors = CONFIG.NEON_COLORS[state.colorIndex];
            document.documentElement.style.setProperty('--neon-primary', colors.primary);
            document.documentElement.style.setProperty('--neon-secondary', colors.secondary);
            document.documentElement.style.setProperty('--neon-accent', colors.accent);
        }

        // ============================================
        // CONTROLES DO PLAYER
        // ============================================
        async function togglePlay() {
            if (state.isPlaying) {
                elements.audio.pause();
                state.isPlaying = false;
                updatePlayButton();
            } else {
                elements.loadingOverlay.classList.add('active');
                
                try {
                    elements.audio.src = CONFIG.STREAM_URL;
                    await elements.audio.play();
                    
                    state.isPlaying = true;
                    initAudioContext();
                    updatePlayButton();
                } catch (error) {
                    console.error('Erro ao tocar:', error);
                    alert('Erro ao conectar ao stream. Verifique a URL.');
                } finally {
                    elements.loadingOverlay.classList.remove('active');
                }
            }
            updateStatus();
        }

        function stop() {
            elements.audio.pause();
            elements.audio.currentTime = 0;
            elements.audio.src = '';
            state.isPlaying = false;
            updatePlayButton();
            updateStatus();
        }

        function updatePlayButton() {
            if (state.isPlaying) {
                elements.btnPlay.classList.add('playing');
                elements.iconPlay.style.display = 'none';
                elements.iconPause.style.display = 'block';
            } else {
                elements.btnPlay.classList.remove('playing');
                elements.iconPlay.style.display = 'block';
                elements.iconPause.style.display = 'none';
            }
        }

        function updateStatus() {
            if (state.isPlaying) {
                elements.statusBadge.classList.add('live');
                elements.statusText.textContent = 'ON AIR';
            } else {
                elements.statusBadge.classList.remove('live');
                elements.statusText.textContent = 'OFFLINE';
            }
        }

        function toggleMute() {
            state.isMuted = !state.isMuted;
            elements.audio.muted = state.isMuted;
            
            if (state.isMuted) {
                elements.iconVol.style.display = 'none';
                elements.iconMute.style.display = 'block';
            } else {
                elements.iconVol.style.display = 'block';
                elements.iconMute.style.display = 'none';
            }
        }

        function setVolume(value) {
            state.volume = parseFloat(value);
            elements.audio.volume = state.volume;
            elements.volSlider.value = state.volume;
            elements.volValue.textContent = Math.round(state.volume * 100) + '%';
            
            // Atualizar cor do slider
            const colors = CONFIG.NEON_COLORS[state.colorIndex];
            elements.volSlider.style.background = `linear-gradient(to right, ${colors.primary} 0%, ${colors.secondary} ${state.volume * 100}%, rgba(255,255,255,0.1) ${state.volume * 100}%, rgba(255,255,255,0.1) 100%)`;
        }

        // ============================================
        // AUDIO CONTEXT E ANALYSER
        // ============================================
        function initAudioContext() {
            if (state.audioContext) return;
            
            try {
                state.audioContext = new (window.AudioContext || window.webkitAudioContext)();
                state.analyser = state.audioContext.createAnalyser();
                state.analyser.fftSize = 128;
                state.analyser.smoothingTimeConstant = 0.8;
                
                const source = state.audioContext.createMediaElementSource(elements.audio);
                source.connect(state.analyser);
                state.analyser.connect(state.audioContext.destination);
                
                state.dataArray = new Uint8Array(state.analyser.frequencyBinCount);
            } catch (error) {
                console.error('Erro ao inicializar AudioContext:', error);
            }
        }

        // ============================================
        // VISUALIZADOR DE √ÅUDIO CIRCULAR
        // ============================================
        class CircularVisualizer {
            constructor(canvas) {
                this.canvas = canvas;
                this.ctx = canvas.getContext('2d');
                this.time = 0;
                this.resize();
                
                window.addEventListener('resize', () => this.resize());
                this.animate();
            }

            resize() {
                const rect = this.canvas.parentElement.getBoundingClientRect();
                this.canvas.width = rect.width * 2;
                this.canvas.height = rect.height * 2;
                this.ctx.scale(2, 2);
                this.width = rect.width;
                this.height = rect.height;
            }

            animate() {
                const colors = CONFIG.NEON_COLORS[state.colorIndex];
                const centerX = this.width / 2;
                const centerY = this.height / 2;
                const radius = Math.min(centerX, centerY) - 50;

                this.ctx.clearRect(0, 0, this.width, this.height);
                this.time += 0.03;

                // C√≠rculos conc√™ntricos pulsantes
                for (let i = 0; i < 4; i++) {
                    const pulseRadius = radius * (0.5 + i * 0.12) + Math.sin(this.time + i * 0.5) * 8;
                    const gradient = this.ctx.createRadialGradient(
                        centerX, centerY, pulseRadius * 0.7,
                        centerX, centerY, pulseRadius
                    );
                    gradient.addColorStop(0, 'transparent');
                    gradient.addColorStop(0.5, hexToRgba(colors.primary, 0.1));
                    gradient.addColorStop(1, 'transparent');

                    this.ctx.beginPath();
                    this.ctx.arc(centerX, centerY, pulseRadius, 0, Math.PI * 2);
                    this.ctx.strokeStyle = gradient;
                    this.ctx.lineWidth = 1.5;
                    this.ctx.stroke();
                }

                // Barras circulares
                const barCount = 72;
                const barWidth = (Math.PI * 2 * radius) / barCount * 0.6;

                for (let i = 0; i < barCount; i++) {
                    const angle = (i / barCount) * Math.PI * 2 - Math.PI / 2;
                    
                    let barHeight = 8;
                    
                    // Se estiver tocando e tiver dados do analyser
                    if (state.isPlaying && state.dataArray) {
                        const dataIndex = Math.floor((i / barCount) * state.dataArray.length);
                        const value = state.dataArray[dataIndex] || 0;
                        barHeight = 8 + (value / 255) * 45;
                    } else {
                        // Anima√ß√£o idle
                        barHeight = 8 + Math.sin(this.time * 2 + i * 0.3) * 6;
                    }

                    const x1 = centerX + Math.cos(angle) * radius;
                    const y1 = centerY + Math.sin(angle) * radius;
                    const x2 = centerX + Math.cos(angle) * (radius + barHeight);
                    const y2 = centerY + Math.sin(angle) * (radius + barHeight);

                    const gradient = this.ctx.createLinearGradient(x1, y1, x2, y2);
                    gradient.addColorStop(0, colors.primary);
                    gradient.addColorStop(0.5, colors.secondary);
                    gradient.addColorStop(1, colors.accent);

                    this.ctx.beginPath();
                    this.ctx.moveTo(x1, y1);
                    this.ctx.lineTo(x2, y2);
                    this.ctx.strokeStyle = gradient;
                    this.ctx.lineWidth = barWidth;
                    this.ctx.lineCap = 'round';
                    this.ctx.stroke();

                    // Glow nas barras
                    this.ctx.shadowColor = colors.primary;
                    this.ctx.shadowBlur = 8;
                    this.ctx.stroke();
                    this.ctx.shadowBlur = 0;
                }

                // C√≠rculo central glow
                const centerGradient = this.ctx.createRadialGradient(
                    centerX, centerY, 0,
                    centerX, centerY, radius * 0.4
                );
                centerGradient.addColorStop(0, hexToRgba(colors.primary, 0.15));
                centerGradient.addColorStop(1, 'transparent');

                this.ctx.beginPath();
                this.ctx.arc(centerX, centerY, radius * 0.4, 0, Math.PI * 2);
                this.ctx.fillStyle = centerGradient;
                this.ctx.fill();

                // Atualizar dados do analyser
                if (state.analyser && state.dataArray) {
                    state.analyser.getByteFrequencyData(state.dataArray);
                }

                requestAnimationFrame(() => this.animate());
            }
        }

        // ============================================
        // METADATA, CAPAS E BACKGROUND
        // ============================================
        async function fetchMetadata() {
            try {
                const response = await fetch(CONFIG.STATUS_URL, { cache: 'no-store' });
                const data = await response.json();
                
                let title = '';
                const src = data.icestats?.source;
                
                if (Array.isArray(src)) {
                    const active = src.find(s => s.title) || src[0];
                    title = active?.title;
                } else if (src?.title) {
                    title = src.title;
                }

                if (title && title !== state.lastTitle) {
                    state.lastTitle = title;
                    updateTrackInfo(title);
                }
            } catch (error) {
                console.error('Erro ao buscar metadata:', error);
            }
        }

        function updateTrackInfo(fullTitle) {
            let artist = '';
            let title = fullTitle;
            
            if (fullTitle.includes(' - ')) {
                const parts = fullTitle.split(' - ');
                artist = parts.shift().trim();
                title = parts.join(' - ').trim();
            }

            elements.trackTitle.textContent = title || 'Desconhecido';
            elements.trackArtist.textContent = artist || 'Artista Desconhecido';
            document.title = `${title} | Indie Neon Radio`;

            // --- ALTERA√á√ÉO: BACKGROUND DIN√ÇMICO ---
            // Usa o t√≠tulo completo como semente para gerar um wallpaper √∫nico para a m√∫sica
            const seed = encodeURIComponent(fullTitle);
            const bgUrl = `https://picsum.photos/seed/${seed}/1920/1080.jpg`;
            document.body.style.backgroundImage = `url('${bgUrl}')`;

            // Buscar capa
            if (artist && title) {
                fetchAlbumCover(artist, title);
            }
        }

        async function fetchAlbumCover(artist, track) {
            try {
                const url = `https://ws.audioscrobbler.com/2.0/?method=track.getInfo&api_key=${CONFIG.LASTFM_KEY}&artist=${encodeURIComponent(artist)}&track=${encodeURIComponent(track)}&format=json`;
                const response = await fetch(url);
                const data = await response.json();
                
                const image = data?.track?.album?.image?.find(img => img.size === 'extralarge')?.['#text'];
                
                if (image) {
                    elements.albumCover.innerHTML = `<img src="${image}" alt="Album Cover" onerror="this.style.display='none'">`;
                }
            } catch (error) {
                console.error('Erro ao buscar capa:', error);
            }
        }

        // ============================================
        // EVENT LISTENERS
        // ============================================
        elements.btnPlay.addEventListener('click', togglePlay);
        elements.btnStop.addEventListener('click', stop);
        elements.btnMute.addEventListener('click', toggleMute);

        elements.volSlider.addEventListener('input', (e) => {
            setVolume(e.target.value);
        });

        elements.btnVolDown.addEventListener('click', () => {
            const newVol = Math.max(0, state.volume - 0.1);
            setVolume(newVol);
        });

        elements.btnLike.addEventListener('click', () => {
            state.liked = !state.liked;
            elements.btnLike.classList.toggle('active', state.liked);
        });

        elements.btnShare.addEventListener('click', () => {
            if (navigator.share) {
                navigator.share({
                    title: 'R√°dio Indie Neon',
                    text: `Ou√ßa ${elements.trackTitle.textContent} na R√°dio Indie Neon!`,
                    url: window.location.href
                });
            } else {
                // Copiar link para clipboard
                navigator.clipboard.writeText(window.location.href);
                alert('Link copiado para a √°rea de transfer√™ncia!');
            }
        });

        // ============================================
        // INICIALIZA√á√ÉO
        // ============================================
        function init() {
            // Configurar volume inicial
            setVolume(state.volume);
            
            // Define um background inicial padr√£o antes da primeira m√∫sica
            document.body.style.backgroundImage = `url('https://picsum.photos/seed/indie_neon_start/1920/1080.jpg')`;
            
            // Iniciar visualizador
            new CircularVisualizer(elements.visualizerCanvas);
            
            // Iniciar altern√¢ncia de cores
            setInterval(() => {
                state.colorIndex = (state.colorIndex + 1) % CONFIG.NEON_COLORS.length;
                updateColors();
            }, 5000);
            
            // Buscar metadata periodicamente
            fetchMetadata();
            setInterval(fetchMetadata, CONFIG.META_INTERVAL);
            
            // Eventos do √°udio
            elements.audio.addEventListener('error', (e) => {
                console.error('Erro no √°udio:', e);
                state.isPlaying = false;
                updatePlayButton();
                updateStatus();
            });
            
            console.log('üéµ R√°dio Indie Neon iniciada!');
            console.log('üìª Stream:', CONFIG.STREAM_URL);
        }

        // Iniciar quando DOM estiver pronto
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', init);
        } else {
            init();
        }
    </script>
</body>
</html>
